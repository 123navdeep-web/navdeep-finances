<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense and Savings Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #f0f2f8; --card: #fff; --text: #1a1a2e; --text2: #6b7280; --text3: #9ca3af;
      --r: 24px; --sha: 0 8px 32px rgba(0,0,0,.08); --sha-lg: 0 20px 60px rgba(0,0,0,.12);
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    input,select,button,textarea { font-family:inherit; }
    ::-webkit-scrollbar { width:4px; }
    ::-webkit-scrollbar-thumb { background:rgba(0,0,0,.1); border-radius:99px; }
    body { background:var(--bg); font-family:'DM Sans',sans-serif; color:var(--text); min-height:100vh; }

    .blob-bg { position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
    .blob { position:absolute; border-radius:50%; filter:blur(80px); opacity:.3; }
    .b1 { width:500px;height:500px;background:#a855f7;top:-150px;left:-100px;animation:bm1 20s ease-in-out infinite alternate; }
    .b2 { width:400px;height:400px;background:#fbbf24;bottom:-100px;right:-100px;animation:bm2 25s ease-in-out infinite alternate; }
    .b3 { width:280px;height:280px;background:#38bdf8;top:40%;right:8%;animation:bm3 18s ease-in-out infinite alternate; }
    @keyframes bm1 { to{transform:translate(60px,80px) scale(1.1)} }
    @keyframes bm2 { to{transform:translate(-50px,-60px) scale(1.05)} }
    @keyframes bm3 { to{transform:translate(30px,-40px) scale(0.9)} }

    .page { position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:28px 24px 80px; }

    .hdr { display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:14px; }
    .hdr-title { font-family:'DM Serif Display',serif;font-size:32px;line-height:1.1; }
    .hdr-title em { font-style:italic;color:#a855f7; }
    .hdr-actions { display:flex;gap:8px;flex-wrap:wrap;align-items:center; }

    .btn { border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:6px;border-radius:99px; }
    .btn-sm { padding:9px 18px;font-size:12px; }
    .btn-outline { background:#fff;color:var(--text2);border:1.5px solid rgba(0,0,0,.1);box-shadow:0 2px 8px rgba(0,0,0,.06); }
    .btn-outline:hover { border-color:#a855f7;color:#a855f7; }
    .btn-primary { background:linear-gradient(135deg,#a855f7,#6366f1);color:#fff;box-shadow:0 6px 20px rgba(168,85,247,.4); }
    .btn-primary:hover { transform:translateY(-2px);box-shadow:0 10px 28px rgba(168,85,247,.5); }
    .btn-income-g { background:linear-gradient(135deg,#34d399,#059669);color:#fff;box-shadow:0 6px 20px rgba(52,211,153,.4); }
    .btn-income-g:hover { transform:translateY(-2px); }
    .btn-danger { background:rgba(239,68,68,.08);color:#ef4444;border:none;border-radius:8px;padding:5px 9px;font-size:13px;cursor:pointer;transition:all .15s; }
    .btn-danger:hover { background:rgba(239,68,68,.18); }
    .btn-add { padding:11px 22px;font-size:13px;border-radius:14px; }

    .tabs { background:#fff;border-radius:16px;padding:5px;display:inline-flex;gap:3px;box-shadow:var(--sha);margin-bottom:28px;flex-wrap:wrap; }
    .tab { background:none;border:none;cursor:pointer;padding:9px 22px;border-radius:11px;font-size:13px;font-weight:600;font-family:'DM Sans',sans-serif;transition:all .2s;color:var(--text2); }
    .tab.on { background:linear-gradient(135deg,#a855f7,#6366f1);color:#fff;box-shadow:0 4px 16px rgba(168,85,247,.4); }
    .tab:hover:not(.on) { background:rgba(168,85,247,.07);color:#a855f7; }

    .card { background:#fff;border-radius:var(--r);box-shadow:var(--sha);padding:24px;position:relative;overflow:hidden; }
    .g2 { display:grid;grid-template-columns:1fr 1fr;gap:16px; }
    .g3 { display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px; }
    .g4 { display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:14px; }

    .scard { border-radius:20px;padding:22px;color:#fff;position:relative;overflow:hidden; }
    .scard::before { content:'';position:absolute;top:-30%;right:-20%;width:160px;height:160px;background:rgba(255,255,255,.15);border-radius:50%; }
    .scard::after  { content:'';position:absolute;bottom:-40%;left:-10%;width:120px;height:120px;background:rgba(255,255,255,.08);border-radius:50%; }
    .scard-eye { font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;opacity:.75;margin-bottom:8px; }
    .scard-val { font-family:'DM Serif Display',serif;font-size:28px;line-height:1;margin-bottom:6px; }
    .scard-sub { font-size:11px;opacity:.7;font-weight:500; }

    .pb { height:8px;background:rgba(0,0,0,.06);border-radius:99px;overflow:hidden; }
    .pf { height:100%;border-radius:99px;transition:width .7s cubic-bezier(.4,0,.2,1); }

    .bubble-area { display:flex;flex-wrap:wrap;gap:12px;align-items:center;padding:8px 0;min-height:180px; }
    .bub { border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;flex-shrink:0;cursor:default;transition:transform .25s,box-shadow .25s; }
    .bub:hover { transform:scale(1.07); }
    .bub-lbl { font-size:10px;font-weight:700;opacity:.85;margin-bottom:1px; }
    .bub-val { font-family:'DM Serif Display',serif;font-size:20px;line-height:1.15; }
    .bub-val-sm { font-size:14px; }

    .bc-wrap { display:flex;align-items:flex-end;gap:12px;height:175px;padding-bottom:28px;position:relative;overflow-x:auto; }
    .bc-grp { display:flex;flex-direction:column;align-items:center;flex:0 0 auto;min-width:52px; }
    .bc-cols { display:flex;align-items:flex-end;gap:3px;height:130px; }
    .bc-bar { border-radius:6px 6px 0 0;width:14px;transition:height .6s cubic-bezier(.4,0,.2,1);position:relative;cursor:pointer; }
    .bc-bar:hover::after { content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:#1a1a2e;color:#fff;border-radius:8px;padding:5px 9px;font-size:10px;font-weight:600;white-space:nowrap;z-index:10;pointer-events:none;font-family:'DM Sans',sans-serif; }
    .bc-lbl { font-size:9px;color:var(--text3);font-weight:700;text-align:center;margin-top:6px;text-transform:uppercase;letter-spacing:.5px; }
    .bc-leg { display:flex;gap:16px;margin-bottom:12px; }
    .bc-li { display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text2);font-weight:600; }
    .bc-dot { width:10px;height:10px;border-radius:3px; }

    .dn-wrap { position:relative;display:inline-block; }
    .dn-mid { position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center; }
    .dn-mid-lbl { font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1px; }
    .dn-mid-val { font-family:'DM Serif Display',serif;font-size:20px;color:var(--text); }

    .row { display:flex;align-items:center;gap:12px;padding:13px 0;border-bottom:1px solid rgba(0,0,0,.05); }
    .row:last-child { border-bottom:none; }
    .row-icon { width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0; }
    .row-info { flex:1; }
    .row-name { font-size:13px;font-weight:600; }
    .row-date { font-size:11px;color:var(--text3);margin-top:1px; }
    .row-amt { font-size:14px;font-weight:700; }
    .over-chip { display:inline-flex;padding:2px 7px;border-radius:6px;font-size:10px;font-weight:700;background:rgba(239,68,68,.12);color:#ef4444;margin-left:8px; }

    .inc-bar { height:10px;background:rgba(0,0,0,.06);border-radius:99px;overflow:hidden;display:flex; }
    .inc-bar-s { background:linear-gradient(90deg,#f472b6,#e11d48);transition:width .6s;border-radius:99px 0 0 99px; }
    .inc-bar-v { background:linear-gradient(90deg,#a855f7,#6366f1);transition:width .6s; }

    .mpills { display:flex;gap:6px;flex-wrap:wrap; }
    .mpill { padding:5px 13px;border-radius:99px;font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;border:1.5px solid transparent;font-family:'DM Sans',sans-serif; }
    .mpill.on { background:linear-gradient(135deg,#a855f7,#6366f1);color:#fff;box-shadow:0 4px 14px rgba(168,85,247,.35); }
    .mpill:not(.on) { background:#fff;color:var(--text2);border-color:rgba(0,0,0,.1); }
    .mpill:not(.on):hover { border-color:#a855f7;color:#a855f7; }

    .flbl { font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px; }
    .fi { background:rgba(0,0,0,.04);border:1.5px solid transparent;border-radius:14px;padding:11px 16px;color:var(--text);font-size:13px;width:100%;outline:none;transition:all .2s;font-weight:500;font-family:'DM Sans',sans-serif; }
    .fi::placeholder { color:var(--text3); }
    .fi:focus { background:#fff;border-color:#a855f7;box-shadow:0 0 0 4px rgba(168,85,247,.1); }
    .fi option { background:#fff;color:var(--text); }

    .ov { position:fixed;inset:0;background:rgba(0,0,0,.3);backdrop-filter:blur(10px);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px; }
    .mod { background:#fff;border-radius:28px;padding:36px;width:100%;max-width:480px;box-shadow:0 40px 100px rgba(0,0,0,.18);animation:modIn .28s cubic-bezier(.34,1.56,.64,1); }
    .mod-w { max-width:680px;max-height:88vh;overflow-y:auto; }
    @keyframes modIn { from{opacity:0;transform:scale(.92)} to{opacity:1;transform:scale(1)} }
    .mod-title { font-family:'DM Serif Display',serif;font-size:24px;margin-bottom:4px; }
    .mod-sub { font-size:13px;color:var(--text2);margin-bottom:28px; }
    .mod-acts { display:flex;gap:10px;margin-top:28px; }
    .mod-ok { flex:1;padding:14px;border-radius:14px;background:linear-gradient(135deg,#a855f7,#6366f1);color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;box-shadow:0 6px 20px rgba(168,85,247,.4); }
    .mod-ok:hover { transform:translateY(-1px); }
    .mod-ok:disabled { opacity:.4;cursor:not-allowed;transform:none; }
    .mod-ok-g { background:linear-gradient(135deg,#34d399,#059669);box-shadow:0 6px 20px rgba(52,211,153,.4); }
    .mod-cn { flex:1;padding:14px;border-radius:14px;background:rgba(0,0,0,.06);color:var(--text2);font-size:14px;font-weight:700;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s; }
    .mod-cn:hover { background:rgba(0,0,0,.1); }

    .uzone { border:2px dashed rgba(168,85,247,.35);border-radius:20px;padding:44px 24px;text-align:center;cursor:pointer;transition:all .25s;background:rgba(168,85,247,.03);position:relative; }
    .uzone:hover,.uzone.drag { border-color:#a855f7;background:rgba(168,85,247,.08); }
    .uzone input { position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%; }

    .rv-hdr { display:flex;gap:10px;padding:0 14px 10px;border-bottom:1.5px solid rgba(0,0,0,.07);margin-bottom:8px; }
    .rv-row { display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;margin-bottom:4px; }
    .rv-row:hover { background:rgba(0,0,0,.03); }
    .rv-row.dim { opacity:.35; }
    .chk { width:20px;height:20px;border-radius:6px;border:2px solid rgba(0,0,0,.15);background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s; }
    .chk.on { background:linear-gradient(135deg,#a855f7,#6366f1);border-color:transparent; }
    .spin { width:40px;height:40px;border:3px solid rgba(168,85,247,.2);border-top-color:#a855f7;border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 20px; }
    @keyframes spin { to{transform:rotate(360deg)} }

    .banner { background:rgba(251,191,36,.1);border:1.5px solid rgba(251,191,36,.3);border-radius:14px;padding:10px 18px;font-size:12px;color:#92400e;font-weight:600;margin-bottom:24px; }
    .empty { text-align:center;padding:52px 0;color:var(--text3);font-size:13px;font-weight:500; }
    .empty-ico { font-size:36px;display:block;margin-bottom:10px; }
    .gt { background:linear-gradient(135deg,#a855f7,#6366f1);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
    .gt-g { background:linear-gradient(135deg,#34d399,#059669);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text; }
    .toast { position:fixed;bottom:32px;left:50%;transform:translateX(-50%);background:#1a1a2e;color:#fff;padding:12px 24px;border-radius:99px;font-size:13px;font-weight:600;z-index:500;white-space:nowrap;box-shadow:0 8px 32px rgba(0,0,0,.25);animation:tIn .3s cubic-bezier(.34,1.56,.64,1); }
    @keyframes tIn { from{opacity:0;transform:translateX(-50%) translateY(14px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }
    @media(max-width:640px){.g2,.g3{grid-template-columns:1fr!important}.g4{grid-template-columns:1fr 1fr!important}}
  </style>
</head>
<body>
<div class="blob-bg">
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
</div>
<div id="root"></div>
<script type="text/babel">
const {useState,useRef,useMemo}=React;

const BUDGET={Rent:2500,Groceries:600,Car:500,Utilities:150,Phone:80,Insurance:200,Misc:400};
const TOTAL_BUDGET=Object.values(BUDGET).reduce((a,b)=>a+b,0);
const GOAL=100000;
const CATS=Object.keys(BUDGET);
const GRAD={Rent:"linear-gradient(135deg,#ee0979,#ff6b6b)",Groceries:"linear-gradient(135deg,#ff6b35,#ffd32a)",Car:"linear-gradient(135deg,#6366f1,#a855f7)",Utilities:"linear-gradient(135deg,#0891b2,#2dd4bf)",Phone:"linear-gradient(135deg,#059669,#34d399)",Insurance:"linear-gradient(135deg,#e11d48,#f472b6)",Misc:"linear-gradient(135deg,#2563eb,#38bdf8)"};
const COLOR={Rent:"#ee0979",Groceries:"#ff6b35",Car:"#6366f1",Utilities:"#0891b2",Phone:"#059669",Insurance:"#e11d48",Misc:"#2563eb"};
const ICON={Rent:"üè†",Groceries:"üõí",Car:"üöó",Utilities:"üí°",Phone:"üì±",Insurance:"üõ°Ô∏è",Misc:"üì¶"};

const fmt=n=>"$"+Number(n).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});
const fmtK=n=>n>=1000?"$"+(n/1000).toFixed(1)+"k":fmt(n);
const mkDate=()=>new Date().toISOString().split("T")[0];
const mkMonth=()=>{const d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0");};
const mkLabel=k=>{const[y,m]=k.split("-");return new Date(y,m-1).toLocaleString("default",{month:"long",year:"numeric"});};
const mkShort=k=>{const[y,m]=k.split("-");return new Date(y,m-1).toLocaleString("default",{month:"short"});};

function Donut({cats,total,size=180,stk=24}){
  const r=(size-stk)/2,circ=2*Math.PI*r;
  let off=0;
  const segs=cats.filter(c=>c.v>0).map(c=>{const dash=(c.v/(total||1))*circ;const s={...c,dash,off};off+=dash;return s;});
  return(
    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`} style={{transform:"rotate(-90deg)"}}>
      <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="rgba(0,0,0,.06)" strokeWidth={stk}/>
      {segs.map((s,i)=><circle key={i} cx={size/2} cy={size/2} r={r} fill="none" stroke={s.col} strokeWidth={stk} strokeDasharray={`${s.dash} ${circ-s.dash}`} strokeDashoffset={-s.off} strokeLinecap="butt"/>)}
    </svg>
  );
}

function Bubbles({cats,total}){
  const sorted=[...cats].filter(c=>c.v>0).sort((a,b)=>b.v-a.v);
  if(!sorted.length)return<div className="empty"><span className="empty-ico">ü´ß</span>Add expenses to see bubbles</div>;
  const maxV=sorted[0].v;
  return(
    <div className="bubble-area">
      {sorted.map((c,i)=>{
        const s=Math.round(72+((c.v/maxV)*90));
        return(
          <div key={c.label} className="bub" style={{width:s,height:s,background:GRAD[c.label],boxShadow:`0 8px 28px ${COLOR[c.label]}55`}}>
            {s>100&&<div className="bub-lbl">{c.label}</div>}
            <div className={s>100?"bub-val":"bub-val bub-val-sm"}>{fmtK(c.v)}</div>
          </div>
        );
      })}
    </div>
  );
}

function BarChart({months,iByM,spdByM,savByM}){
  const maxV=Math.max(...months.map(m=>Math.max(iByM[m]||0,spdByM[m]||0,savByM[m]||0)),1);
  const H=120;
  return(
    <div>
      <div className="bc-leg">
        {[{c:"#34d399",l:"Income"},{c:"#f472b6",l:"Spent"},{c:"#a855f7",l:"Saved"}].map(x=>(
          <div key={x.l} className="bc-li"><div className="bc-dot" style={{background:x.c}}/>{x.l}</div>
        ))}
      </div>
      <div className="bc-wrap">
        {months.map(m=>{
          const bars=[
            {v:iByM[m]||0,g:"linear-gradient(180deg,#34d399,#059669)",tip:fmt(iByM[m]||0)},
            {v:spdByM[m]||0,g:"linear-gradient(180deg,#f472b6,#e11d48)",tip:fmt(spdByM[m]||0)},
            {v:savByM[m]||0,g:"linear-gradient(180deg,#a855f7,#6366f1)",tip:fmt(savByM[m]||0)},
          ];
          return(
            <div key={m} className="bc-grp">
              <div className="bc-cols">
                {bars.map((b,j)=><div key={j} className="bc-bar" data-tip={b.tip} style={{height:Math.max(3,(b.v/maxV)*H),background:b.g,boxShadow:`0 4px 10px ${['#34d399','#f472b6','#a855f7'][j]}55`}}/>)}
              </div>
              <div className="bc-lbl">{mkShort(m)}</div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

async function parseStmt(file){
  const b64=await new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result.split(",")[1]);r.onerror=()=>rej(new Error("Read failed"));r.readAsDataURL(file);});
  const isPDF=file.type==="application/pdf",isImg=file.type.startsWith("image/");
  if(!isPDF&&!isImg)throw new Error("Please upload a PDF or image.");
  const cb=isPDF?{type:"document",source:{type:"base64",media_type:"application/pdf",data:b64}}:{type:"image",source:{type:"base64",media_type:file.type,data:b64}};
  const prompt=`Parse this bank/credit card statement. Extract ALL expense transactions (debits/charges only). Skip credits/refunds. Return ONLY JSON array. Each item: {date:"YYYY-MM-DD",description:"max 40 chars",amount:positive_number,category:"Rent|Groceries|Car|Utilities|Phone|Insurance|Misc"}. No markdown.`;
  const resp=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:4096,messages:[{role:"user",content:[cb,{type:"text",text:prompt}]}]})});
  if(!resp.ok)throw new Error("API error "+resp.status);
  const data=await resp.json();
  const text=(data.content||[]).map(b=>b.text||"").join("").replace(/```json|```/g,"").trim();
  const parsed=JSON.parse(text);
  if(!Array.isArray(parsed))throw new Error("Unexpected response");
  if(!parsed.length)throw new Error("No expense transactions found.");
  return parsed.map((x,i)=>({...x,id:Date.now()+i,include:true,amount:parseFloat(x.amount)||0,category:CATS.includes(x.category)?x.category:"Misc"}));
}

function App(){
  const[expenses,setExpenses]=useState([]);
  const[incomes,setIncomes]=useState([]);
  const[savings,setSavings]=useState([]);
  const[eDate,setEDate]=useState(mkDate());const[eCat,setECat]=useState("Groceries");const[eAmt,setEAmt]=useState("");const[eNote,setENote]=useState("");
  const[iDate,setIDate]=useState(mkDate());const[iAmt,setIAmt]=useState("");const[iNote,setINote]=useState("");
  const[sDate,setSDate]=useState(mkDate());const[sAmt,setSAmt]=useState("");const[sNote,setSNote]=useState("");
  const[activeMonth,setActiveMonth]=useState(mkMonth());
  const[tab,setTab]=useState("dashboard");
  const[showSav,setShowSav]=useState(false);
  const[showInc,setShowInc]=useState(false);
  const[showImp,setShowImp]=useState(false);
  const[impText,setImpText]=useState("");const[impErr,setImpErr]=useState("");
  const[toast,setToast]=useState("");
  const[showStmt,setShowStmt]=useState(false);
  const[pStage,setPStage]=useState("upload");
  const[pItems,setPItems]=useState([]);
  const[pErr,setPErr]=useState("");
  const[drag,setDrag]=useState(false);
  const fileRef=useRef();const stmtRef=useRef();

  const T=msg=>{setToast(msg);setTimeout(()=>setToast(""),2800);};

  const addExp=()=>{const a=parseFloat(eAmt);if(!a||a<=0)return;setExpenses(p=>[{id:Date.now(),date:eDate,category:eCat,amount:a,note:eNote},...p]);setEAmt("");setENote("");T("Expense added ‚úì");};
  const addInc=()=>{const a=parseFloat(iAmt);if(!a||a<=0)return;setIncomes(p=>[{id:Date.now(),date:iDate,amount:a,note:iNote},...p]);setIAmt("");setINote("");setShowInc(false);T("Income logged ‚úì");};
  const addSav=()=>{const a=parseFloat(sAmt);if(!a||a<=0)return;setSavings(p=>[{id:Date.now(),date:sDate,amount:a,note:sNote},...p]);setSAmt("");setSNote("");setShowSav(false);T("Savings logged ‚úì");};

  const exportData=()=>{const blob=new Blob([JSON.stringify({expenses,incomes,savings,exportedAt:new Date().toISOString(),version:3},null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="finances-"+mkDate()+".json";a.click();URL.revokeObjectURL(url);T("Saved! ‚úì");};
  const handleDF=e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{setImpText(ev.target.result);setShowImp(true);setImpErr("");};r.readAsText(f);e.target.value="";};
  const doImport=()=>{try{const d=JSON.parse(impText);if(!Array.isArray(d.expenses)||!Array.isArray(d.savings))throw new Error();setExpenses(d.expenses);setSavings(d.savings);setIncomes(Array.isArray(d.incomes)?d.incomes:[]);setShowImp(false);setImpText("");T("Data loaded! ‚úì");}catch{setImpErr("Invalid file.");}};
  const handleSF=async f=>{setPStage("parsing");setPErr("");try{const items=await parseStmt(f);setPItems(items);setPStage("review");}catch(err){setPErr(err.message||"Failed.");setPStage("upload");}};
  const commitP=()=>{const ta=pItems.filter(i=>i.include&&i.amount>0).map(i=>({id:Date.now()+Math.random(),date:i.date,category:i.category,amount:i.amount,note:i.description}));setExpenses(p=>[...ta,...p]);setShowStmt(false);T(ta.length+" expenses imported ‚úì");};
  const togItem=id=>setPItems(p=>p.map(i=>i.id===id?{...i,include:!i.include}:i));
  const chgCat=(id,cat)=>setPItems(p=>p.map(i=>i.id===id?{...i,category:cat}:i));
  const inclN=pItems.filter(i=>i.include).length;
  const inclT=pItems.filter(i=>i.include).reduce((a,i)=>a+i.amount,0);

  const mExp=expenses.filter(e=>e.date.startsWith(activeMonth));
  const mInc=incomes.filter(i=>i.date.startsWith(activeMonth));
  const totalSpent=mExp.reduce((a,e)=>a+e.amount,0);
  const totalIncome=mInc.reduce((a,i)=>a+i.amount,0);
  const autoSaved=Math.max(0,totalIncome-totalSpent);
  const byCat=CATS.reduce((acc,c)=>{acc[c]=mExp.filter(e=>e.category===c).reduce((a,e)=>a+e.amount,0);return acc;},{});
  const totalSaved=savings.reduce((a,s)=>a+s.amount,0);
  const savPct=Math.min((totalSaved/GOAL)*100,100);
  const timePct=(()=>{const s=new Date("2026-01-15"),e=new Date("2027-02-01"),n=new Date();return Math.min(Math.max(0,(n-s)/(e-s))*100,100);})();

  const allMonths=useMemo(()=>{const s=new Set([...expenses.map(e=>e.date.slice(0,7)),...incomes.map(i=>i.date.slice(0,7)),...savings.map(s=>s.date.slice(0,7))]);if(!s.has(mkMonth()))s.add(mkMonth());return[...s].sort().reverse();},[expenses,incomes,savings]);
  const iByM=useMemo(()=>allMonths.reduce((acc,m)=>{acc[m]=incomes.filter(i=>i.date.startsWith(m)).reduce((a,i)=>a+i.amount,0);return acc;},{}),[incomes,allMonths]);
  const spdByM=useMemo(()=>allMonths.reduce((acc,m)=>{acc[m]=expenses.filter(e=>e.date.startsWith(m)).reduce((a,e)=>a+e.amount,0);return acc;},{}),[expenses,allMonths]);
  const savByM=useMemo(()=>allMonths.reduce((acc,m)=>{acc[m]=savings.filter(s=>s.date.startsWith(m)).reduce((a,s)=>a+s.amount,0);return acc;},{}),[savings,allMonths]);
  const donutCats=CATS.map(c=>({label:c,v:byCat[c]||0,col:COLOR[c]}));
  const bubCats=CATS.map(c=>({label:c,v:byCat[c]||0}));

  const MP=(
    <div className="mpills">
      {allMonths.slice(0,8).map(m=>(
        <button key={m} className={"mpill"+(activeMonth===m?" on":"")} onClick={()=>setActiveMonth(m)}>
          {mkShort(m)} '{m.slice(2,4)}
        </button>
      ))}
    </div>
  );

  const EF=(
    <div style={{display:"grid",gridTemplateColumns:"110px 145px 115px 1fr auto",gap:10,alignItems:"end"}}>
      <div><div className="flbl">Date</div><input className="fi" type="date" value={eDate} onChange={e=>setEDate(e.target.value)}/></div>
      <div><div className="flbl">Category</div><select className="fi" value={eCat} onChange={e=>setECat(e.target.value)}>{CATS.map(c=><option key={c}>{c}</option>)}</select></div>
      <div><div className="flbl">Amount</div><input className="fi" type="number" min="0" step="0.01" placeholder="0.00" value={eAmt} onChange={e=>setEAmt(e.target.value)}/></div>
      <div><div className="flbl">Note</div><input className="fi" type="text" placeholder="Optional‚Ä¶" value={eNote} onChange={e=>setENote(e.target.value)}/></div>
      <div style={{display:"flex",alignItems:"flex-end"}}><button className="btn btn-primary btn-add" onClick={addExp}>+ Add</button></div>
    </div>
  );

  return(
    <div className="page">
      {toast&&<div className="toast">{toast}</div>}

      <div className="hdr">
        <div className="hdr-title">Expense & <em>Savings Tracker</em></div>
        <div className="hdr-actions">
          <input ref={fileRef} type="file" accept=".json" style={{display:"none"}} onChange={handleDF}/>
          <button className="btn btn-outline btn-sm" onClick={()=>fileRef.current.click()}>üìÇ Load</button>
          <button className="btn btn-outline btn-sm" style={{borderColor:"rgba(52,211,153,.4)",color:"#059669"}} onClick={exportData}>üíæ Save</button>
          <button className="btn btn-outline btn-sm" style={{borderColor:"rgba(168,85,247,.4)",color:"#a855f7"}} onClick={()=>{setPStage("upload");setPItems([]);setPErr("");setShowStmt(true);}}>üè¶ Statement</button>
          <button className="btn btn-income-g btn-sm" onClick={()=>setShowInc(true)}>+ Income</button>
          <button className="btn btn-primary btn-sm" onClick={()=>setShowSav(true)}>+ Savings</button>
        </div>
      </div>

      <div className="banner">‚ö†Ô∏è Data lives in session only ‚Äî <strong>üíæ Save</strong> before closing, <strong>üìÇ Load</strong> to restore.</div>

      <div className="tabs">
        {["dashboard","expenses","income","savings"].map(t=>(
          <button key={t} className={"tab"+(tab===t?" on":"")} onClick={()=>setTab(t)}>{t[0].toUpperCase()+t.slice(1)}</button>
        ))}
      </div>

      {tab==="dashboard"&&(
        <div>
          <div className="g4" style={{marginBottom:18}}>
            {[
              {lbl:"Month Income",val:totalIncome,sub:mkLabel(activeMonth),g:"linear-gradient(135deg,#34d399,#059669)",sh:"rgba(52,211,153,.35)"},
              {lbl:"Month Spent",val:totalSpent,sub:`of ${fmt(TOTAL_BUDGET)} budget`,g:totalSpent>TOTAL_BUDGET?"linear-gradient(135deg,#f472b6,#e11d48)":"linear-gradient(135deg,#f97316,#ffd32a)",sh:"rgba(249,115,22,.35)"},
              {lbl:"Auto Saved",val:autoSaved,sub:"income ‚àí expenses",g:"linear-gradient(135deg,#a855f7,#6366f1)",sh:"rgba(168,85,247,.35)"},
              {lbl:"Total Banked",val:totalSaved,sub:`${savPct.toFixed(1)}% of $100k`,g:"linear-gradient(135deg,#2563eb,#38bdf8)",sh:"rgba(37,99,235,.35)"},
            ].map(s=>(
              <div key={s.lbl} className="scard" style={{background:s.g,boxShadow:`0 12px 40px ${s.sh}`}}>
                <div className="scard-eye">{s.lbl}</div>
                <div className="scard-val">{fmt(s.val)}</div>
                <div className="scard-sub">{s.sub}</div>
              </div>
            ))}
          </div>

          <div className="g2" style={{marginBottom:18}}>
            {[
              {lbl:"$100k Savings Goal",pct:savPct,fill:"linear-gradient(90deg,#a855f7,#6366f1)",col:"#a855f7",sub:`${fmt(totalSaved)} saved ¬∑ ${fmt(GOAL-totalSaved)} to go`},
              {lbl:"Journey to Feb 2027",pct:timePct,fill:"linear-gradient(90deg,#f97316,#fbbf24)",col:"#f97316",sub:"Jan 2026 ‚Üí Feb 2027"},
            ].map(b=>(
              <div key={b.lbl} className="card">
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:14}}>
                  <div style={{fontSize:13,fontWeight:700}}>{b.lbl}</div>
                  <div style={{fontFamily:"'DM Serif Display',serif",fontSize:24,color:b.col}}>{b.pct.toFixed(1)}%</div>
                </div>
                <div className="pb"><div className="pf" style={{width:b.pct+"%",background:b.fill,boxShadow:`0 0 8px ${b.col}66`}}/></div>
                <div style={{fontSize:11,color:"var(--text2)",marginTop:10,fontWeight:500}}>{b.sub}</div>
              </div>
            ))}
          </div>

          <div className="g2" style={{marginBottom:18}}>
            <div className="card">
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,flexWrap:"wrap",gap:10}}>
                <div>
                  <div style={{fontSize:13,fontWeight:700}}>Spending Bubbles</div>
                  <div style={{fontSize:11,color:"var(--text2)",marginTop:2}}>Size = amount spent</div>
                </div>
                {MP}
              </div>
              <Bubbles cats={bubCats} total={totalSpent}/>
            </div>
            <div className="card">
              <div style={{fontSize:13,fontWeight:700,marginBottom:3}}>Monthly Overview</div>
              <div style={{fontSize:11,color:"var(--text2)",marginBottom:16}}>Income, Spent & Saved</div>
              {allMonths.length>0
                ?<BarChart months={[...allMonths].reverse()} iByM={iByM} spdByM={spdByM} savByM={savByM}/>
                :<div className="empty"><span className="empty-ico">üìä</span>Add data to see chart</div>}
            </div>
          </div>

          {totalIncome>0&&(
            <div className="card" style={{marginBottom:18}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:10}}>
                <div style={{fontSize:15,fontWeight:700}}>{mkLabel(activeMonth)} Summary</div>
                {MP}
              </div>
              <div className="g3" style={{gap:12,marginBottom:18}}>
                {[
                  {lbl:"Income",val:totalIncome,pct:100,g:"linear-gradient(135deg,#34d399,#059669)",sh:"rgba(52,211,153,.35)"},
                  {lbl:"Spent",val:totalSpent,pct:totalIncome?(totalSpent/totalIncome)*100:0,g:"linear-gradient(135deg,#f472b6,#e11d48)",sh:"rgba(244,114,182,.35)"},
                  {lbl:"Surplus",val:autoSaved,pct:totalIncome?(autoSaved/totalIncome)*100:0,g:"linear-gradient(135deg,#a855f7,#6366f1)",sh:"rgba(168,85,247,.35)"},
                ].map(s=>(
                  <div key={s.lbl} style={{borderRadius:16,padding:"16px",background:s.g,color:"#fff",boxShadow:`0 8px 24px ${s.sh}`,position:"relative",overflow:"hidden"}}>
                    <div style={{position:"absolute",top:-20,right:-20,width:80,height:80,background:"rgba(255,255,255,.15)",borderRadius:"50%"}}/>
                    <div style={{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",opacity:.8,marginBottom:8}}>{s.lbl}</div>
                    <div style={{fontFamily:"'DM Serif Display',serif",fontSize:24}}>{fmt(s.val)}</div>
                    <div style={{fontSize:10,opacity:.7,marginTop:4}}>{s.pct.toFixed(1)}% of income</div>
                  </div>
                ))}
              </div>
              <div className="inc-bar">
                <div className="inc-bar-s" style={{width:totalIncome?Math.min((totalSpent/totalIncome)*100,100)+"%":"0%"}}/>
                <div className="inc-bar-v" style={{width:totalIncome?Math.min((autoSaved/totalIncome)*100,100)+"%":"0%"}}/>
              </div>
              <div style={{display:"flex",gap:16,marginTop:8}}>
                {[{c:"#e11d48",l:"Spent"},{c:"#a855f7",l:"Surplus"}].map(x=>(
                  <div key={x.l} style={{display:"flex",alignItems:"center",gap:5}}>
                    <div style={{width:8,height:8,borderRadius:2,background:x.c}}/>
                    <span style={{fontSize:10,color:"var(--text3)",fontWeight:700}}>{x.l}</span>
                  </div>
                ))}
              </div>
            </div>
          )}

          <div className="card" style={{marginBottom:18}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:10}}>
              <div style={{fontSize:15,fontWeight:700}}>Budget Breakdown</div>
              {MP}
            </div>
            <div className="g2" style={{gap:12,marginBottom:20}}>
              <div style={{display:"flex",alignItems:"center",justifyContent:"center"}}>
                <div className="dn-wrap">
                  <Donut cats={donutCats} total={totalSpent} size={170} stk={22}/>
                  <div className="dn-mid">
                    <div className="dn-mid-lbl">Total</div>
                    <div className="dn-mid-val">{fmtK(totalSpent)}</div>
                  </div>
                </div>
              </div>
              <div style={{display:"flex",flexDirection:"column",justifyContent:"center",gap:9}}>
                {CATS.filter(c=>byCat[c]>0).sort((a,b)=>byCat[b]-byCat[a]).map(c=>{
                  const pct=totalSpent?(byCat[c]/totalSpent)*100:0;
                  return(
                    <div key={c} style={{display:"flex",alignItems:"center",gap:8}}>
                      <div style={{width:8,height:8,borderRadius:2,background:COLOR[c],flexShrink:0}}/>
                      <div style={{flex:1,fontSize:12,fontWeight:600}}>{c}</div>
                      <div style={{fontSize:11,color:"var(--text2)",fontWeight:600}}>{fmt(byCat[c])}</div>
                      <div style={{fontSize:10,color:"var(--text3)",fontWeight:700,minWidth:28,textAlign:"right"}}>{pct.toFixed(0)}%</div>
                    </div>
                  );
                })}
                {CATS.every(c=>!byCat[c])&&<div style={{color:"var(--text3)",fontSize:12}}>No expenses yet</div>}
              </div>
            </div>
            {CATS.map(c=>{
              const val=byCat[c]||0,bud=BUDGET[c],pct=Math.min((val/bud)*100,100),over=val>bud;
              return(
                <div key={c} className="row" style={{paddingTop:10,paddingBottom:10}}>
                  <div style={{width:36,height:36,borderRadius:10,background:GRAD[c],display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0}}>{ICON[c]}</div>
                  <div style={{flex:1}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                      <span style={{fontSize:13,fontWeight:600}}>{c}{over&&<span className="over-chip">+{fmt(val-bud)}</span>}</span>
                      <span style={{fontSize:12,fontWeight:700,color:over?"#ef4444":"var(--text)"}}>{fmt(val)} <span style={{color:"var(--text3)",fontWeight:500}}>/ {fmt(bud)}</span></span>
                    </div>
                    <div className="pb"><div className="pf" style={{width:pct+"%",background:over?"linear-gradient(90deg,#ef4444,#f87171)":GRAD[c]}}/></div>
                  </div>
                </div>
              );
            })}
          </div>

          <div className="card">
            <div style={{fontSize:13,fontWeight:700,marginBottom:16}}>Quick Add Expense</div>
            {EF}
          </div>
        </div>
      )}

      {tab==="expenses"&&(
        <div>
          <div className="card" style={{marginBottom:16}}>
            <div style={{fontSize:13,fontWeight:700,marginBottom:16}}>Log Expense</div>
            {EF}
          </div>
          <div className="card">
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:10}}>
              <div>
                <div style={{fontSize:15,fontWeight:700}}>{mkLabel(activeMonth)}</div>
                <div style={{fontSize:11,color:"var(--text2)",marginTop:2}}>{mExp.length} transactions</div>
              </div>
              {MP}
            </div>
            {mExp.length===0
              ?<div className="empty"><span className="empty-ico">üì≠</span>No expenses for {mkLabel(activeMonth)}</div>
              :[...mExp].sort((a,b)=>b.date.localeCompare(a.date)).map(e=>(
                <div key={e.id} className="row">
                  <div className="row-icon" style={{background:GRAD[e.category]}}>{ICON[e.category]}</div>
                  <div className="row-info">
                    <div className="row-name">{e.category}{e.note&&<span style={{color:"var(--text2)",fontWeight:400}}> ¬∑ {e.note}</span>}</div>
                    <div className="row-date">{e.date}</div>
                  </div>
                  <div className="row-amt">{fmt(e.amount)}</div>
                  <button className="btn-danger" onClick={()=>setExpenses(p=>p.filter(x=>x.id!==e.id))}>‚úï</button>
                </div>
              ))
            }
            {mExp.length>0&&(
              <div style={{display:"flex",justifyContent:"space-between",paddingTop:16,marginTop:8,borderTop:"1.5px solid rgba(0,0,0,.07)"}}>
                <span style={{fontSize:13,color:"var(--text2)",fontWeight:600}}>Total</span>
                <span style={{fontFamily:"'DM Serif Display',serif",fontSize:20,color:totalSpent>TOTAL_BUDGET?"#ef4444":"var(--text)"}}>{fmt(totalSpent)}</span>
              </div>
            )}
          </div>
        </div>
      )}

      {tab==="income"&&(
        <div>
          <div className="card" style={{marginBottom:16}}>
            <div style={{fontSize:13,fontWeight:700,marginBottom:16}}>Log Income</div>
            <div style={{display:"grid",gridTemplateColumns:"120px 1fr 1fr auto",gap:10,alignItems:"end"}}>
              <div><div className="flbl">Date</div><input className="fi" type="date" value={iDate} onChange={e=>setIDate(e.target.value)}/></div>
              <div><div className="flbl">Amount ($)</div><input className="fi" type="number" min="0" step="0.01" placeholder="e.g. 12000" value={iAmt} onChange={e=>setIAmt(e.target.value)}/></div>
              <div><div className="flbl">Note</div><input className="fi" type="text" placeholder="Salary, bonus‚Ä¶" value={iNote} onChange={e=>setINote(e.target.value)}/></div>
              <div style={{display:"flex",alignItems:"flex-end"}}><button className="btn btn-income-g btn-add" onClick={addInc}>+ Add</button></div>
            </div>
          </div>
          <div className="card" style={{marginBottom:16}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,flexWrap:"wrap",gap:10}}>
              <div style={{fontSize:15,fontWeight:700}}>{mkLabel(activeMonth)} Summary</div>
              {MP}
            </div>
            <div className="g3" style={{gap:12,marginBottom:18}}>
              {[
                {lbl:"Income",val:totalIncome,g:"linear-gradient(135deg,#34d399,#059669)",sh:"rgba(52,211,153,.35)"},
                {lbl:"Spent",val:totalSpent,g:"linear-gradient(135deg,#f472b6,#e11d48)",sh:"rgba(244,114,182,.35)"},
                {lbl:"Surplus",val:autoSaved,g:"linear-gradient(135deg,#a855f7,#6366f1)",sh:"rgba(168,85,247,.35)"},
              ].map(s=>(
                <div key={s.lbl} style={{borderRadius:16,padding:"18px",background:s.g,color:"#fff",boxShadow:`0 8px 24px ${s.sh}`,position:"relative",overflow:"hidden"}}>
                  <div style={{position:"absolute",top:-20,right:-20,width:80,height:80,background:"rgba(255,255,255,.15)",borderRadius:"50%"}}/>
                  <div style={{fontSize:10,fontWeight:700,letterSpacing:2,textTransform:"uppercase",opacity:.8,marginBottom:8}}>{s.lbl}</div>
                  <div style={{fontFamily:"'DM Serif Display',serif",fontSize:26}}>{fmt(s.val)}</div>
                </div>
              ))}
            </div>
            {totalIncome>0&&(
              <>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
                  <span style={{fontSize:12,color:"var(--text2)",fontWeight:600}}>Spent {((totalSpent/totalIncome)*100).toFixed(1)}%</span>
                  <span style={{fontSize:12,color:"#a855f7",fontWeight:700}}>Surplus {((autoSaved/totalIncome)*100).toFixed(1)}%</span>
                </div>
                <div className="inc-bar">
                  <div className="inc-bar-s" style={{width:((totalSpent/totalIncome)*100)+"%"}}/>
                  <div className="inc-bar-v" style={{width:((autoSaved/totalIncome)*100)+"%"}}/>
                </div>
              </>
            )}
          </div>
          <div className="card">
            <div style={{fontSize:15,fontWeight:700,marginBottom:16}}>Income Log</div>
            {mInc.length===0
              ?<div className="empty"><span className="empty-ico">üí∞</span>No income logged for {mkLabel(activeMonth)}</div>
              :[...mInc].sort((a,b)=>b.date.localeCompare(a.date)).map(i=>(
                <div key={i.id} className="row">
                  <div className="row-icon" style={{background:"linear-gradient(135deg,#34d399,#059669)"}}>üí∞</div>
                  <div className="row-info">
                    <div className="row-name">Income{i.note&&<span style={{color:"var(--text2)",fontWeight:400}}> ¬∑ {i.note}</span>}</div>
                    <div className="row-date">{i.date}</div>
                  </div>
                  <div className="row-amt gt-g">+{fmt(i.amount)}</div>
                  <button className="btn-danger" onClick={()=>setIncomes(p=>p.filter(x=>x.id!==i.id))}>‚úï</button>
                </div>
              ))
            }
          </div>
        </div>
      )}

      {tab==="savings"&&(
        <div>
          <div className="g2" style={{marginBottom:18}}>
            <div className="scard" style={{background:"linear-gradient(135deg,#a855f7,#6366f1)",boxShadow:"0 12px 40px rgba(168,85,247,.4)"}}>
              <div className="scard-eye">Total Saved</div>
              <div className="scard-val">{fmt(totalSaved)}</div>
              <div style={{margin:"14px 0 8px"}}>
                <div style={{height:6,background:"rgba(255,255,255,.2)",borderRadius:99}}>
                  <div style={{height:"100%",background:"rgba(255,255,255,.9)",borderRadius:99,width:savPct+"%",transition:"width .7s"}}/>
                </div>
              </div>
              <div className="scard-sub">{savPct.toFixed(1)}% ¬∑ {fmt(GOAL-totalSaved)} remaining</div>
            </div>
            <div className="card">
              <div style={{fontSize:11,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:2,marginBottom:10}}>Projected by Feb 2027</div>
              {savings.length>1?(()=>{
                const tots=savings.reduce((acc,s)=>{const m=s.date.slice(0,7);acc[m]=(acc[m]||0)+s.amount;return acc;},{});
                const avg=Object.values(tots).reduce((a,b)=>a+b,0)/Object.keys(tots).length;
                const left=Math.max(0,(new Date("2027-02-01")-new Date())/(1000*60*60*24*30));
                const proj=totalSaved+avg*left;
                return(
                  <div>
                    <div style={{fontFamily:"'DM Serif Display',serif",fontSize:34,color:proj>=GOAL?"#059669":"#f97316",marginBottom:10}}>{fmt(proj)}</div>
                    <div style={{display:"inline-flex",alignItems:"center",gap:6,padding:"5px 12px",borderRadius:99,fontSize:11,fontWeight:700,background:proj>=GOAL?"rgba(5,150,105,.1)":"rgba(249,115,22,.1)",color:proj>=GOAL?"#059669":"#f97316"}}>
                      {proj>=GOAL?"üéâ On track!":"üìà Keep saving"} ¬∑ Avg {fmt(avg)}/mo
                    </div>
                  </div>
                );
              })():<div style={{color:"var(--text3)",fontSize:13}}>Log 2+ months to see projection</div>}
            </div>
          </div>
          <div className="card">
            <div style={{fontSize:15,fontWeight:700,marginBottom:16}}>Savings Log</div>
            {savings.length===0
              ?<div className="empty"><span className="empty-ico">üè¶</span>No savings yet ‚Äî hit "+ Savings" above</div>
              :[...savings].sort((a,b)=>b.date.localeCompare(a.date)).map(s=>(
                <div key={s.id} className="row">
                  <div className="row-icon" style={{background:"linear-gradient(135deg,#a855f7,#6366f1)"}}>üíú</div>
                  <div className="row-info">
                    <div className="row-name">Savings{s.note&&<span style={{color:"var(--text2)",fontWeight:400}}> ¬∑ {s.note}</span>}</div>
                    <div className="row-date">{s.date}</div>
                  </div>
                  <div className="row-amt gt">+{fmt(s.amount)}</div>
                  <button className="btn-danger" onClick={()=>setSavings(p=>p.filter(x=>x.id!==s.id))}>‚úï</button>
                </div>
              ))
            }
          </div>
        </div>
      )}

      {showInc&&(
        <div className="ov" onClick={()=>setShowInc(false)}>
          <div className="mod" onClick={e=>e.stopPropagation()}>
            <div className="mod-title">Log Income</div>
            <div className="mod-sub">Record your salary, bonus, or any income</div>
            <div style={{marginBottom:14}}><div className="flbl">Date</div><input className="fi" type="date" value={iDate} onChange={e=>setIDate(e.target.value)}/></div>
            <div style={{marginBottom:14}}><div className="flbl">Amount ($)</div><input className="fi" type="number" min="0" step="0.01" placeholder="e.g. 12000" value={iAmt} onChange={e=>setIAmt(e.target.value)} autoFocus/></div>
            <div><div className="flbl">Note (optional)</div><input className="fi" type="text" placeholder="Salary, bonus, freelance‚Ä¶" value={iNote} onChange={e=>setINote(e.target.value)}/></div>
            <div className="mod-acts">
              <button className="mod-ok mod-ok-g" onClick={addInc}>Save Income</button>
              <button className="mod-cn" onClick={()=>setShowInc(false)}>Cancel</button>
            </div>
          </div>
        </div>
      )}

      {showSav&&(
        <div className="ov" onClick={()=>setShowSav(false)}>
          <div className="mod" onClick={e=>e.stopPropagation()}>
            <div className="mod-title">Log Savings</div>
            <div className="mod-sub">Every dollar closer to your goal üéØ</div>
            <div style={{marginBottom:14}}><div className="flbl">Date</div><input className="fi" type="date" value={sDate} onChange={e=>setSDate(e.target.value)}/></div>
            <div style={{marginBottom:14}}><div className="flbl">Amount ($)</div><input className="fi" type="number" min="0" step="0.01" placeholder="e.g. 7500" value={sAmt} onChange={e=>setSAmt(e.target.value)} autoFocus/></div>
            <div><div className="flbl">Note (optional)</div><input className="fi" type="text" placeholder="Jan paycheck, bonus‚Ä¶" value={sNote} onChange={e=>setSNote(e.target.value)}/></div>
            <div className="mod-acts">
              <button className="mod-ok" onClick={addSav}>Save</button>
              <button className="mod-cn" onClick={()=>setShowSav(false)}>Cancel</button>
            </div>
          </div>
        </div>
      )}

      {showStmt&&(
        <div className="ov" onClick={()=>{if(pStage!=="parsing")setShowStmt(false);}}>
          <div className="mod mod-w" onClick={e=>e.stopPropagation()}>
            {pStage==="upload"&&(
              <div>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}}>
                  <div className="mod-title">Import Statement</div>
                  <button className="btn-danger" style={{fontSize:18}} onClick={()=>setShowStmt(false)}>‚úï</button>
                </div>
                <div className="mod-sub">AI extracts & categorizes every expense automatically</div>
                {pErr&&<div style={{background:"rgba(239,68,68,.08)",border:"1.5px solid rgba(239,68,68,.2)",borderRadius:12,padding:"12px 16px",marginBottom:20,fontSize:13,color:"#ef4444"}}>{pErr}</div>}
                <div className={"uzone"+(drag?" drag":"")} onDragOver={e=>{e.preventDefault();setDrag(true);}} onDragLeave={()=>setDrag(false)} onDrop={e=>{e.preventDefault();setDrag(false);const f=e.dataTransfer?.files[0];if(f)handleSF(f);}}>
                  <input ref={stmtRef} type="file" accept=".pdf,image/*" onChange={e=>{const f=e.target.files[0];if(f)handleSF(f);e.target.value="";}}/>
                  <div style={{fontSize:48,marginBottom:14}}>üè¶</div>
                  <div style={{fontFamily:"'DM Serif Display',serif",fontSize:20,marginBottom:6}}>Drop your statement</div>
                  <div style={{fontSize:13,color:"var(--text2)",marginBottom:20}}>Chase, Citi, BofA, Wells Fargo ‚Äî PDF or image</div>
                  <button className="btn btn-primary" style={{padding:"10px 24px",fontSize:13}} onClick={()=>stmtRef.current.click()}>Choose File</button>
                </div>
              </div>
            )}
            {pStage==="parsing"&&(
              <div style={{textAlign:"center",padding:"52px 0"}}>
                <div className="spin"/>
                <div style={{fontFamily:"'DM Serif Display',serif",fontSize:22,marginBottom:8}}>Reading your statement‚Ä¶</div>
                <div style={{fontSize:13,color:"var(--text2)"}}>AI is extracting and categorizing expenses</div>
              </div>
            )}
            {pStage==="review"&&(
              <div>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4,flexWrap:"wrap",gap:10}}>
                  <div className="mod-title">Review Expenses</div>
                  <div style={{display:"flex",gap:8,alignItems:"center"}}>
                    <span style={{fontSize:12,color:"var(--text2)",fontWeight:600}}>{inclN} sel ¬∑ {fmt(inclT)}</span>
                    <button className="btn btn-outline" style={{padding:"5px 12px",fontSize:11}} onClick={()=>setPItems(p=>p.map(i=>({...i,include:true})))}>All</button>
                    <button className="btn btn-outline" style={{padding:"5px 12px",fontSize:11}} onClick={()=>setPItems(p=>p.map(i=>({...i,include:false})))}>None</button>
                    <button className="btn-danger" style={{fontSize:18}} onClick={()=>setShowStmt(false)}>‚úï</button>
                  </div>
                </div>
                <div className="mod-sub">{pItems.length} transactions found</div>
                <div className="rv-hdr">
                  <div style={{width:20}}/>
                  <div style={{flex:"0 0 88px",fontSize:10,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:1}}>Date</div>
                  <div style={{flex:1,fontSize:10,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:1}}>Description</div>
                  <div style={{flex:"0 0 110px",fontSize:10,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:1}}>Category</div>
                  <div style={{flex:"0 0 68px",fontSize:10,fontWeight:700,color:"var(--text3)",textTransform:"uppercase",letterSpacing:1,textAlign:"right"}}>Amount</div>
                </div>
                <div style={{maxHeight:280,overflowY:"auto"}}>
                  {pItems.map(item=>(
                    <div key={item.id} className={"rv-row"+(!item.include?" dim":"")}>
                      <div className={"chk"+(item.include?" on":"")} onClick={()=>togItem(item.id)}>
                        {item.include&&<span style={{color:"#fff",fontSize:11,fontWeight:700}}>‚úì</span>}
                      </div>
                      <div style={{flex:"0 0 88px",fontSize:12,color:"var(--text2)",fontWeight:500}}>{item.date}</div>
                      <div style={{flex:1,fontSize:12,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{item.description}</div>
                      <select style={{flex:"0 0 110px",background:"rgba(0,0,0,.04)",border:"1.5px solid transparent",borderRadius:8,color:"var(--text)",fontSize:11,padding:"4px 8px",outline:"none",fontWeight:600,cursor:"pointer",fontFamily:"'DM Sans',sans-serif"}} value={item.category} onChange={e=>chgCat(item.id,e.target.value)}>
                        {CATS.map(c=><option key={c}>{c}</option>)}
                      </select>
                      <div style={{flex:"0 0 68px",textAlign:"right",fontSize:13,fontWeight:700,color:item.include?"var(--text)":"var(--text3)"}}>{fmt(item.amount)}</div>
                    </div>
                  ))}
                </div>
                <div className="mod-acts">
                  <button className="mod-ok mod-ok-g" onClick={commitP} disabled={inclN===0}>Import {inclN} Expenses ({fmt(inclT)})</button>
                  <button className="mod-cn" onClick={()=>{setPStage("upload");setPItems([]);}}>Re-upload</button>
                </div>
              </div>
            )}
          </div>
        </div>
      )}

      {showImp&&(
        <div className="ov" onClick={()=>setShowImp(false)}>
          <div className="mod" onClick={e=>e.stopPropagation()}>
            <div className="mod-title">Load Saved Data?</div>
            <div className="mod-sub">Replaces current session with your saved file.</div>
            {impErr&&<div style={{color:"#ef4444",fontSize:13,fontWeight:600,marginBottom:14}}>{impErr}</div>}
            <div className="mod-acts">
              <button className="mod-ok" onClick={doImport}>Yes, Load It</button>
              <button className="mod-cn" onClick={()=>setShowImp(false)}>Cancel</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
